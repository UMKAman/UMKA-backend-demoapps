<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: User.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: User.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * User.js
 *
 * @description :: TODO: You might write a short summary of how this model works and what it represents here.
 * @docs        :: http://sailsjs.org/documentation/concepts/models-and-orm/models
 */

/**
 * @namespace User
 * @prop {string} phone телефон
 * @prop {string} name имя
 * @prop {blob/string} avatar аватар
 * @prop {string} about о себе
 * @prop {boolean} isMaster мастер?
 * @prop {boolean} isAdmin админ
 * @prop {string} city Город
 * @prop {enum} gender Муж/Жен
 * @prop {collection} favorite список избранных мастеров
 * @prop {collection} orderHistory история заказов
 * @prop {collection} jwts список выданных токенов
 * 
 */
module.exports = {

  attributes: {
    phone: { type: 'string', unique: true },
    name: { type: 'string' },
    avatar: { type: 'string' },
    isAdmin: { type: 'boolean', defaultsTo: false },
    about: { type: 'string' },
    isMaster: { type: 'boolean', defaultsTo: false },
    city: { type: 'string' },
    gender: { type: 'string', enum: ['Муж', 'Жен'] },
    // master: { model: 'master' },

    favorite: {
      collection: 'master',
      via: 'inFavorite',
      dominant: true
    },
    orderHistory: {
      collection: 'order',
      via: 'user'
    },
    jwts: {
      collection: 'jwt',
      via: 'user'
    },
    fireTokens: {
      collection: 'fireToken',
      via: 'user',
    },
    /**
     * @method generateNewSMS
     */
    generateNewSMS: function () {
      return Sms.create({ phone: this.phone, code: codegen(4) }).then(created => {
        return smsBeeline.send(this.phone, created.code);
      })
    }
  },

  /**
   * @method checkSMSCode
   * @param  {string} phone
   * @param  {string} code
   * @static 
   */
  checkSMSCode(phone, code) {
    return Sms.findOne({ phone: finded.phone })
      .then(finded => {
        if (finded.code === code) {
          return finded.destroy();
        } else {
          throw { code: 9 };
        }
      }).then(() => {
        return User.create({ phone: phone });
      })
  },
  beforeCreate: function (data, cb) {
    if (data &amp;&amp; data.phone) {
      switch (data.phone) {
        case '+79138401916':
        case '+79539263080':
          data.isAdmin = true;
          break;
        default:
          break;
      }
    }
    cb();
  }
};

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="Chat.html">Chat</a></li><li><a href="Currency%2520.html">Currency </a></li><li><a href="FireToken.html">FireToken</a></li><li><a href="Jwt.html">Jwt</a></li><li><a href="Master.html">Master</a></li><li><a href="Messages.html">Messages</a></li><li><a href="Order.html">Order</a></li><li><a href="PortfolioPic.html">PortfolioPic</a></li><li><a href="Protfolio.html">Protfolio</a></li><li><a href="Review.html">Review</a></li><li><a href="serviceMaster.html">serviceMaster</a></li><li><a href="Sms.html">Sms</a></li><li><a href="Specialization.html">Specialization</a></li><li><a href="User.html">User</a></li><li><a href="Workday.html">Workday</a></li><li><a href="Workhour.html">Workhour</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_">_</a></li><li><a href="global.html#admin">admin</a></li><li><a href="global.html">checkCode</a></li><li><a href="global.html">checkSMSCode</a></li><li><a href="global.html#generateNewSMS">generateNewSMS</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Mon May 29 2017 20:41:39 GMT+0700 (+07)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
